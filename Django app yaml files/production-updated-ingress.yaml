apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: seu-apim-ingress
  namespace: seu-apim
  annotations:
    kubernetes.io/ingress.class: nginx
    
    # SSL/TLS
    nginx.ingress.kubernetes.io/ssl-redirect: "true"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
    
    # Proxy headers for Django
    nginx.ingress.kubernetes.io/proxy-set-header: |
      Host $host;
      X-Real-IP $remote_addr;
      X-Forwarded-For $proxy_add_x_forwarded_for;
      X-Forwarded-Proto $scheme;
      X-Forwarded-Host $host;
      X-Forwarded-Port $server_port;
    
    # CORS
    nginx.ingress.kubernetes.io/enable-cors: "true"
    nginx.ingress.kubernetes.io/cors-allow-methods: "GET, POST, PUT, DELETE, OPTIONS, PATCH"
    nginx.ingress.kubernetes.io/cors-allow-origin: "https://py.seu.edu.sa"
    nginx.ingress.kubernetes.io/cors-allow-headers: "DNT,User-Agent,X-Requested-With,If-Modified-Since,Cache-Control,Content-Type,Range,Authorization,X-CSRFToken"
    nginx.ingress.kubernetes.io/cors-allow-credentials: "true"
    
    # Timeouts and sizes
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "60"
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "60"
    
    # Buffers
    nginx.ingress.kubernetes.io/proxy-buffer-size: "128k"
    nginx.ingress.kubernetes.io/proxy-buffers: "4 256k"
    nginx.ingress.kubernetes.io/proxy-busy-buffers-size: "256k"
    
    # Additional Django-specific settings
    nginx.ingress.kubernetes.io/configuration-snippet: |
      proxy_set_header X-Forwarded-Proto https;
      proxy_set_header X-Forwarded-Host py.seu.edu.sa;
      proxy_set_header X-Forwarded-Port 443;
      proxy_cookie_path / "/; Secure; HttpOnly; SameSite=Lax";
    
spec:
  tls:
  - hosts:
    - py.seu.edu.sa
    secretName: seu-apim-tls
  rules:
  - host: py.seu.edu.sa
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: seu-apim-service
            port:
              number: 80